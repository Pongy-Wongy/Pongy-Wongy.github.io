---
layout: single
title: "수정하기(UPDATE)"
excerpt: "게시판 수정하기를 배워보자!!"
categories: SpringBoot
tag: SpringBoot
toc: true
published: true
---

1. 모든 상풍(글)마다 수정버튼만든 후 클릭하면 수정페이지로 이동
2. 수정 폼양식이 양식에 기존데이터가 저장되있어야함
3. 폼양식 수정하고 전송하면 새로운데이터로 DB에 저장

## 수정버튼 만들기
일단 수정페이지가 필요하므로 update.html을 하나 만들자.

```html
<body>
    <div th:replace="~{nav.html::navbar}"></div>

    <div class="card" th:each="i : ${product}">
        <img src="/images/anime.png" alt="애니메이션">
        <div>
            <a th:href="@{'/products/' + ${i.id} }">
                <h4 th:text="${i.title}">더미타이틀</h4>
            </a>
            <p th:text="${i.price}">더미가격</p>
            <a th:href="update/???">✏️</a>
        </div>
    </div>
</body>
```

???에는 해당상품의 id번호가 오면된다.
일단 하나의 상품에 하나의 수정만 먼저 만들어보자 
id가 1번인 상품의 수정기능만 만들고 그 다음 모든상품에  
적용시켜보자.


```html
<body>
    <div th:replace="~{nav.html::navbar}"></div>

    <div class="card" th:each="i : ${product}">
        <img src="/images/anime.png" alt="애니메이션">
        <div>
            <a th:href="@{'/products/' + ${i.id} }">
                <h4 th:text="${i.title}">더미타이틀</h4>
            </a>
            <p th:text="${i.price}">더미가격</p>
            <a href="update/1">수정버튼</a>
        </div>
    </div>
</body>
```

그 ???를 1로바뀌었다.그 다음 <a>태그는 Get방식이니깐
@Controller에서 Get방식으로 코드를 짜면된다.

```java
@GetMapping("/update/{id}") // 수정페이지
    String update(Model model) {
      (수정api코드 짜느곳)
      return "update.html"
    }
```

update/1로 접속해보자
![Spring 이미지](/assets/images/spring10.png)
접속완료!!

## 수정 폼양식에 상품데이터가 저장되있어야함
```java
@GetMapping("/update/{id}")
String edit(Model model) {
  Optional<Item> result = itemRepository.findById(1);
  if (result.isPresent()) {
    model.addAttribute("product", result.get());
    return "update.html";
  } else {
    return "redirect:/list";
  }
}
```

여기까지는 쉽다. id가 1인 상품을 result변수에 저장했고(**findById(1)**)
result변수에 저장된게 있으면 **Model model** 를 사용해서
product에 담아 html에 서버 데이터넣어서 보내줄 수 있다.

이제 남은거 수정페이지에서 기존 상품데이터의 title,price가 
input칸에 채워져있어야 한다. 어떻게 할까?
모르면 무조건 검색하자 한번 검색해보자!!

![Spring 이미지](/assets/images/spring101.png)
위의 검색결과같이 **th:value**,**th:field** 두 가지를 사용 할 수 있나보다.  
일단 **th:value**를 사용해보자

```html
  <form action="/update" method="POST">
        <input name="title" th:value="${product.title}">
        <input name="price" th:value="${product.price}">
        <button type="submit">전송</button>
    </form>
``` 

이렇게하면 http://localhost:8080/update/1에 상품아이디가1번인 상품의  
나이키,2000(title,price)가 채워져 있는 걸 볼 수있다.
![Spring 이미지](/assets/images/spring102.png)
근데 문제는 모든상품의 수정폼에 오직 상품아디가 1번인 데이터만 채워져 있다.
이제 각각의 상품데이터를 수정폼에 채워넣어야 한다.

```java
 @GetMapping("/update/{id}")
    String update(@PathVariable Integer id, Model model) {
        Optional<Product> result = productRepository.findById(id);
        if (result.isPresent()) {
            model.addAttribute("product", result.get());
            return "update.html";
        } else {
            return "redirect:/list";
        }
    }
```
저번시간에 배운 url파라미터{id}에 findById(id)를 이용해 
해당상품번호의 데이터를 볼수 있게 했다.

```java
public void updateProduct(Integer id, String title, Integer price) {// 상품수정(update)
        Product product = new Product();
        product.setId(id);
        product.setTitle(title);
        product.setPrice(price);
        productRepository.save(product);
    }
```
그리고 상품수정하는거는 비즈니스로직이므로 @Service레이어에 따로 분리해서  
코딩했다.이제 DI(의존성주입)으로 @Controller에서 위 함수 updateProduct를  
불러오면 된다.

```java
@Controller
@RequiredArgsConstructor
public class ProductController {

    private final ProductRepository productRepository;
    private final ProductService productService;

    @PostMapping("/update")
    String updateProduct(@RequestParam String title, @RequestParam Integer price, Integer id) {
        productService.updateProduct(price, title, id);
        return "redirect:/list";
    }
}
``` 

그리고 update.html에서 POST요청을 날릴때
해당상품의 ID번호도 같이 전송할 수 있게 코딩했다.
(style="display:none"값으로 숨겼다.)

```html
(update.html)

<body>
    <div th:replace="~{nav.html::navbar}"></div>

    <form action="/update" method="POST">
        <input name="id" th:value="${product.id}" style="display: none">
        <input name="title" th:value="${product.title}">
        <input name="price" th:value="${product.price}">
        <button type="submit">전송</button>
    </form>
</body>
```

list.html도 현재 수정버튼을 클릭하면 update/1로만 갈 수 있게 했는데 
이도 수정해보겠다.

```html
(list.html)

<body>
    <div th:replace="~{nav.html::navbar}"></div>

    <div class="card" th:each="i : ${product}">
        <img src="/images/anime.png" alt="애니메이션">
        <div>
            <a th:href="@{'/products/' + ${i.id} }">
                <h4 th:text="${i.title}">더미타이틀</h4>
            </a>
            <p th:text="${i.price}">더미가격</p>
            <a th:href="@{ '/update/' + ${i.id} }">수정</a>
        </div>
    </div>
</body>
```
<a th:href="@{ '/update/' + ${i.id} }">수정</a>코드로 바꾸면
수정링크를 누르면 각각 해당상품id번호페이지로 접속되고 폼에 각 상품의 데이터로  
채워져있다.한번 클릭한다음 접속해보고 상품데이터를 수정해보자  

![Spring 이미지](/assets/images/spring103.png)
[Spring 이미지](/assets/images/spring104.png)!
2번째 상품의 title=옷 price=1000 의 데이터가 폼에 잘 채워져 있는걸 확인할 수 있다.  
이번에는 직접 상품데이터를 수정해보겠다 수정할 데이터는 title=가을옷 price=70000으로 해보겠다. 수정한 값이 DB랑 list페이지에 잘 적용됬나 확인해보자.

[Spring 이미지](/assets/images/spring105.png)!
[Spring 이미지](/assets/images/spring106.png)!
두개다 잘 적용된 걸 확인할 수 있다.

## 결론 
1. 한개의 상품에 대한 수정기능 먼저 만들어 보자
2. thymeleaf문법 **th:value**를 써서 폼양식 데이터를 채워놓자.
3. **url파라미터** **findById(id)**를 사용해 전체상품을 수정할 수 있게 하자
4. 수정 비즈니스 로직을 @Service레이어에 따로 분리한다음 DI를 통해 기능을 추가하자.



















