---
layout: single
title: "상세페이지만들기"
excerpt: "URL파라미터 및 Optional타입으로 상세페이지 만들기"
categories: SpringBoot
tag: SpringBoot
toc: true
published: true
---

기본적으로 쇼핑몰같은경우에 상세페이지로 가면
url주소가 products/상품번호 이렇게 적혀져 있는게 많다.

**products/n --> n번상품 보여주면 끝!**
근데여기서 n은 테이블에 있는 상품ID값이다.
만약 n이 100만이라면 페이지100만개가 필요하고 
그에따른 상품페이지API도 100만개 만들어야 하는데 불가능!!
URL파라미터라는 문법쓰면 쉽게 만들수 있다.


## URL 파라미터
```java
@GetMapping("/products/{id}")
String detail() {
  return "products.html";
} 
```
{} 안에 변수 아무거나 만들어 쓰면 되는데 뒤에 오는 번호가
상품ID번호여서 {id}라고 했음

그럼이제 products/n으로 접속하면 n번상품을 DB에서 가져와서
html 집어넣으면 된다. 
근데 n=id인 행을 테이블에서 출력하는 방법은 뭘까?
구글에 검색해보자!!

![Spring 이미지](/assets/images/spring08.png)
위의사진과 같이 .findById는 조회된 @Entity를 Optional
객체로 반환한다. 

```java
@GetMapping("/products/{id}")
String detail() {
  Optional<Product> result = productRepository.findById(1);
  System.out.println(result.get());
  return "products.html";
} 
```

## Optional<> 타입
Optional 타입의 특징은 **값이 있을 수도 있고 없을 수도 있는** 타입이다.

Optionl은 .get()을 하면 데이터를 불러올수 있다.근데 테이블에있는 값이 null이면
result변수에 아무것도 저장되지 않기때문에 .get()하면 에러가 날 것!!
그럼 직접에러를 내보자!!원래 코딩 잘하려면 에러를 만들줄아는 악성유저가 되는게 좋다!!!

일단 테이블에 있는 데이터를 모두 삭제했다.
그리고 /products/1로 접속해보면 오류가 날것이다.
왜 오류가나냐? 당연히 id가 1인 상품이 없으니깐!!! 정말쉽다!!!

![Spring 이미지](/assets/images/spring081.png)

위처럼 Optional이 비어있을때 NoSuchElementException에러가 발생한 걸 볼 수 있다.
그래서 에러방지를 위해 Optional타입은 **isPresent**랑 같이 많이 쓴다

```java
@GetMapping("/products/{id}")
    String detail() {
        Optional<Product> result = productRepository.findById(1);
        if (result.isPresent()) {
            System.out.println(result.get());
            return "products.html";
        } else {
            return "form.html";
        }
    }
```
result변수에 값이 있으면 상세페이지를 보여주고 없으면
다시 글쓰기페이지로 돌아가게끔 코드를 짜보았다.
이렇게 하면 테이블에 데이터가 없어도 에러를 방지 할 수 있다.

자 이제 에러방지도 했고 남은거 현재 
products/1,products/2 ......products/999  
다 똑같은 html정보만 보여주고있다. 
html에 서버 데이터를 하려면? 저번시간에 배웠다.

## 복습: HTML에 서버데이터 집어넣기
1. 파라미터() 안에 Model model
2. model.addAttribute(“전달한데이터이름”,”데이터”);
3. html파일에서 th:text=”${전달할데이터이름}”

그리고 url파라미터와 @PathVariable을 같이 사용하는게 좋은데.....
구글에 검색해보면......

![Spring 이미지](/assets/images/spring082.png)

자 이제 코드를 짜보자.

```java
@Controller
public class ProductController {
    
    @GetMapping("/products/{id}")  //
    public String detail(@PathVariable Long id, Model model) {  // 
        Optional<Product> product = productRepository.findById(id);
        
        if (product.isPresent()) {  // 
            model.addAttribute("product", product.get());
            return "product.html";
        }
        return "redirect:/list";  // 
    }
}
```

```html
(products.html)

<body>
    <div th:replace="~{nav.html::navbar}"></div>

    <div class="detail" th:each="i : ${product}">
        <h4>상세페이지</h4>
        <img src="/images/anime.png" alt="애니메이션">
        <h4 th:text="${i.title}">상품</h4>
        <p th:text="${i.price}">가격</p>
    </div>
</body>
```
위의 코드처럼 
- **PathVariable** + **url파라미터**  
- **model.addAttribute(“전달한데이터이름”,”데이터”);**
- **thymleaf반복문**을 통해 상세페이지를 잘 구현했다.

한번 코드가 잘 실행이 되는지 확인해보자.

![Spring 이미지](/assets/images/spring083.png)
![Spring 이미지](/assets/images/spring084.png)
![Spring 이미지](/assets/images/spring085.png)

**id값에따라 서로 다른 상품**이 나오는걸 볼 수 있다.

```html
(list.html)

<div class="card" th:each="i : ${product}">
  <img src="https://placehold.co/300">
  <h4 th:text="${i.title}">상품이름</h4>
  <a href="@{'/products/' + ${i.id} }">링크</a>
  <p th:text="${i.price + '원'}">가격</p>
</div>
```
리스트페이지 링크를 타고 갈 수 있게도 해줬다.
- href안에는 @{ } 부터 시작
- 문자는 작은 따옴표 안에 넣고 + 로 합칠수 있음.


## 결론
URL 파라미터({id}) + @PathVariable + Optional<Product> + Model을 활용해 동적 상세페이지 구현 완료!

핵심: /products/{id}로 한 개의 컨트롤러만 만들어도 무한 상품 페이지 생성 가능 (DB 조회로 n번 상품 자동 출력)
에러 방지: Optional.isPresent()로 null 체크 → 데이터 없으면 리다이렉트
데이터 전달: model.addAttribute("product", ...) + Thymeleaf th:text로 HTML 동적 렌더링
연결: 리스트 페이지 <a href="@{'/products/' + ${i.id}}"> 링크로 상세페이지 이동
결과: id별 서로 다른 상품 상세페이지 완벽 출력! (예: /products/1 → 1번 상품, /products/2 → 2번 상품)










