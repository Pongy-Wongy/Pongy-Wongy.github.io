---
layout: single
title: "AJAX로 삭제하기"
excerpt: "게시판 삭제하기를 배워보자!!"
categories: SpringBoot
tag: SpringBoot
toc: true
published: true
---

삭제기능을 어떻게 구현할 수 있지 먼저 글로 만들자.  
그 다음에 코드로 변경하자!!

1. 상품마다 삭제버튼 만들기
2. 삭제버튼누르면 글 삭제
근데 이번에는 **AJAX**를 통해서 삭제기능을 구현할거다.

## AJAX란?
![Spring 이미지](/assets/images/spring11.png)
간단히 정리하면 새로고침없이 서버로 요청날리는 JS코드라고 보면 된다.

## AJAX로 요청하기
어떤JS코드를 쓰냐면 fetch()를 사용해보자

```html
<script>
fetch('/test1')
</script>
```

```java
 @GetMapping("/test1")
    String test1() {
        System.out.println("요청들어옴");
        return "redirect:/list";
    }
```

"요청들어옴"이 잘 출력됬는지 확인해보자
![Spring 이미지](/assets/images/spring111.png)
잘 출력된걸 확인할 수 있다.


## AJAX로 데이터전송 및 출력

### 데이터 전송
```html
<button class="btn">버튼</button>

<script>
      fetch('/test', {
    method : 'POST',
    headers : {
      "Content-Type": "application/json",
    },
    body : JSON.stringify({name : 'park', age : 99})
  })
</script>
```
- method에 어떤 method로 요청할지 설정가능
- body에 어떤 데이터를 서버로 보낼지 설정가능
- headers 전송할데이터의 타입을 설정가능

전송할데이터가 많으면 JS array나 object안에 담아서 전송(java에서의 List/Map)
**array,object로 전송할때**는 **JSON.stringify()**안에 집어넣어서 전달하고
타입을 application/json으로 잘 기입해야 함.

### 데이터 출력

```java
@PostMapping("/test")
String test(@RequestBody Map<String, Object> body) {
  System.out.println(body.get("name"));
  System.out.println(body.get("age"))
  return "redirect:/list";
} 
```
![Spring 이미지](/assets/images/spring112.png)
버튼을 눌렀을때 park,99가 잘 출력되는걸 볼 수 있다.

## queryString으로 데이터 전송 및 출력

### 데이터 전송
```html
<script>
  fetch('/abc?데이터이름=데이터값&데이터이름2=데이터값2') 
</script>
```
그럼 실제 데이터를 전송한다음 출력해보자


```html
<script>
    document.querySelectorAll('.btn')[0].addEventListener('click', function () {
            fetch('/test1?name=kim&age=200')
        })
</script>
```

### 데이터 출력

이 데이터를 출력하는 방법은 간단하게도 **@RequestParam 타입 데이터이름**으로 꺼낼 수 있다.

```java
@GetMapping("/test1")
    String test1(@RequestParam String name, @RequestParam Integer age) {
        System.out.println(name);
        System.out.println(age);
        return "redirect:list";
    }
```
![Spring 이미지](/assets/images/spring113.png)

fetch('/test1?name=kim&age=200') 에 있는 데이터가 잘 출력되는걸 볼 수 있다.

## 삭제기능
```html
 <span th:onclick="fetch('/delete?id=[[${i.id}]]', {method : 'DELETE'})
                .then(r => r.text())
                .then(() => {
                    location.reload();
                })
            ">삭제</span>
```
JS안에 thymeleaf문법 쓰려면 **[[${ 변수 }]]**이렇게 써야한다.
ajax요청후에 서버가 보낸 데이터 출력하려면 .then()2번 붙여주면 된다.
서버가 보내주는 문자 자료면 **r.text**하면 되고 List나 Map자료면
**r.json**으로 쓰면된다.
ajax JS코드는 완료됬고 querystring방식으로 처리했는데 다음번에는
url파라미터를 이용해서 해보자  
일단 삭제API코드를 마무리하자

```java
 @DeleteMapping("/delete")
    ResponseEntity<String> deleteProduct(@RequestParam Integer id) {
        productRepository.deleteById(id);
        return ResponseEntity.status(200).body("삭제완료");
    }
```
queryString으로 보낸 데이터를 출력하려면  
**@RequestParam 타입 데이터이름**을 사용하면된다.
참고로 ajax로 데이터 주고받을거면
서버 측에서 html전송하고 redirect하고 그런게 불가능하기 때문에 **ResponseEntity**  
정도로 메세지만 보내주면 됩니다.

한번 삭제가 잘되나 확인해보자.  
![Spring 이미지](/assets/images/spring114.png)
![Spring 이미지](/assets/images/spring115.png)
id가2인 상품  겨울코트를 삭제해보자 삭제버튼을클릭하면
![Spring 이미지](/assets/images/spring116.png)
DB에서 2번째 상품이 사라진걸 볼 수있다.

이렇게 삭제기능을 1개씩 구현해보고 전체다적용하는 방식을 **queryString**방식으로 적용했다.
다음에는 **url파라미터**를 이용해서 삭제기능을 구현해보자 많은양의 데이터를 보낼때는 이게 더
좋을거같다.


